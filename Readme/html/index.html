<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OPDK API Document: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gemtek_logo.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OPDK API Document
   &#160;<span id="projectnumber">v4.4.1.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Preface">Preface</a><ul><li class="level2"><a href="#Architecture">Architecture</a></li>
<li class="level2"><a href="#Features">Features</a></li>
</ul>
</li>
<li class="level1"><a href="#Quick-Start">Quick-Start Guide</a><ul><li class="level2"><a href="#Overview">Overview</a></li>
<li class="level2"><a href="#Initialization">Initialization</a></li>
<li class="level2"><a href="#Gemtek">Gemtek Initialization</a></li>
<li class="level2"><a href="#Hardware">Hardware Layout</a></li>
</ul>
</li>
<li class="level1"><a href="#License">License</a></li>
<li class="level1"><a href="#Acknowledgements">Acknowledgements</a></li>
<li class="level1"><a href="#sec1">Release Note</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Preface"></a>
Preface</h1>
<h2><a class="anchor" id="Architecture"></a>
Architecture</h2>
<p>The concept of the API follows the concept of primitives of the IEEE Standard for local and metropolitan area networks â€” part 15.4: Low-Rate Wireless Personal Area Networks (IEEE802.15.4-2011).</p>
<p>The upcoming figure shows the concept of primitives of the LoRaMAC layer. The concept follows the Request-Confirm and Indication-Response architecture. The LoRaMAC layer offers MCPS (MAC Common Part Sublayer) services, MLME (MAC layer management entity) services and a MIB (MAC information base).</p>
<p>In general, the LoRaMAC layer utilizes MCPS services for data transmissions and data receptions, and MLME services to manage the LoRaWAN network. The MIB is responsible to store important runtime information and holds the configuration of the LoRaMAC layer.</p>
<p>An upper layer (e.g. the main application) is able to perform <em>Requests</em> which the LoRaMAC layer confirms with a <em>Confirm</em> primitive. The LoRaMAC layer notifies an upper layer with the <em>Indication</em> primitive in case of events. The upper layer may responses to an <em>Indication</em> with the <em>Response</em> primitive.</p>
<div class="image"> <div class="image">
<img src="LoRaMacPrimitives.png" alt="LoRaMacPrimitives.png"/>
</div>
 </div> <hr/>
<h2><a class="anchor" id="Features"></a>
Features</h2>
<p>The LoRaMAC sources are available on GitHub: <a href="https://github.com/Lora-net/LoRaMac-node">https://github.com/Lora-net/LoRaMac-node</a>.</p>
<p>The following features are supported according to the LoRaWAN 1.0.1 specification and LoRaMac-node 4.3.0 codebase</p>
<ul style="list-style-type:disc">
<li>
Device <ul style="list-style-type:square">
<li>
G76S or G78S  </li>
</ul>
</li>
<li>
LoRaWAN device classes <ul style="list-style-type:square">
<li>
Class A  </li>
<li>
Class C  </li>
</ul>
</li>
<li>
ISM Band support <ul style="list-style-type:square">
<li>
AS923 </li>
<li>
AU915 </li>
<li>
CN470 </li>
<li>
CN779 </li>
<li>
EU433 </li>
<li>
EU868 </li>
<li>
IN865 </li>
<li>
KR920 </li>
<li>
US915 </li>
<li>
US915 in hybrid mode </li>
</ul>
</li>
</ul>
<hr/>
<h1><a class="anchor" id="Quick-Start"></a>
Quick-Start Guide</h1>
<h2><a class="anchor" id="Overview"></a>
Overview</h2>
<p>This quick start guide provides a short introduction into important operations of the LoRaMAC layer. Full examples for the different device classes are available in the example section.</p>
<h2><a class="anchor" id="Initialization"></a>
Initialization</h2>
<p>The initialiation function of the LoRaMAC layer is <a href="group___l_o_r_a_m_a_c.html#gaaf9fc660650a5e992c42aee9de29a3c1" class="el">LoRaMacInitialization( LoRaMacPrimitives_t *primitives, LoRaMacCallback_t *callbacks )</a>. The function has two parameters, <a href="struct_lo_ra_mac_primitives__t.html" class="el">LoRaMacPrimitives_t</a> and <a href="struct_lo_ra_mac_callback__t.html" class="el">LoRaMacCallback_t</a>. The parameters define function which have to be defined by upper layers. The first parameter contains function pointers to the <em>Confirm</em> and <em>Indication</em> primitives, and the second parameter contains a function pointer to the function which measures the battery level. This function is available in the board support package.</p>
<p>The following code snippet provides an example for the initialization:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> McpsConfirm( McpsConfirm_t *McpsConfirm )</div><div class="line">{</div><div class="line">  <span class="comment">// Implementation of the MCPS-Confirm primitive</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> McpsIndication( McpsIndication_t *McpsIndication )</div><div class="line">{</div><div class="line">  <span class="comment">// Implementation of the MCPS-Indication primitive</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MlmeConfirm( MlmeConfirm_t *MlmeConfirm )</div><div class="line">{</div><div class="line">  <span class="comment">// Implementation of the MLME-Confirm primitive</span></div><div class="line">}</div><div class="line"></div><div class="line">LoRaMacPrimitives_t LoRaMacPrimitives;</div><div class="line">LoRaMacCallback_t LoRaMacCallbacks;</div><div class="line">LoRaMacStatus_t Status;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">  LoRaMacPrimitives.MacMcpsConfirm = McpsConfirm;</div><div class="line">  LoRaMacPrimitives.MacMcpsIndication = McpsIndication;</div><div class="line">  LoRaMacPrimitives.MacMlmeConfirm = MlmeConfirm;</div><div class="line">  LoRaMacCallbacks.GetBatteryLevel = <a class="code" href="board_8h.html#af76c87dec5209225d7e36c1af950c57d">BoardGetBatteryLevel</a>;</div><div class="line">  Status = <a class="code" href="_lo_ra_mac_8c.html#a7ca445cf825e45999810b3991273eba5">LoRaMacInitialization</a>( &amp;LoRaMacPrimitives, &amp;LoRaMacCallbacks );</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span>( Status == LORAMAC_STATUS_OK )</div><div class="line">  {</div><div class="line">    <span class="comment">// Initialization successful</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --> <hr/>
<h2><a class="anchor" id="Gemtek"></a>
Gemtek Initialization</h2>
<p>Gemtek has two initial functions, which are <a href="_lo_ra_mac_crypto_8h.html#a09f025b3a3b855fe93c84e491d4f4def" class="code">GemtekLoRaMacKeyInit()</a> and <a href="_lo_ra_mac_crypto_8h.html#ac290f1cbded32d9f7867544320004631" class="code">GemtekGetDevAddr()</a>.<br />
 <a href="_lo_ra_mac_crypto_8h.html#a09f025b3a3b855fe93c84e491d4f4def" class="code">GemtekLoRaMacKeyInit()</a> will initial network session key and application session key.<br />
 <a href="_lo_ra_mac_crypto_8h.html#ac290f1cbded32d9f7867544320004631" class="code">GemtekGetDevAddr()</a> will return the Gemtek's device address.</p>
<p>The following code snippet provides an example for the Gemtek initialization:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> uint32_t DevAddr</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <span class="comment">/* Declare LoRaMAC MIB-RequestConfirm structure */</span></div><div class="line">    MibRequestConfirm_t mibReq;</div><div class="line"></div><div class="line">    <span class="comment">/* Initial LoRaMAC AES. </span></div><div class="line"><span class="comment">       Make sure to call this function to initiate related Gemtek&#39;s AES keys */</span></div><div class="line">    <a class="code" href="group___l_o_r_a_m_a_c___c_r_y_p_t_o.html#ga09f025b3a3b855fe93c84e491d4f4def">GemtekLoRaMacKeyInit</a>( );</div><div class="line"></div><div class="line">    <span class="comment">/* Get Gemtek&#39;s device address */</span></div><div class="line">    DevAddr = <a class="code" href="group___l_o_r_a_m_a_c___c_r_y_p_t_o.html#gac290f1cbded32d9f7867544320004631">GemtekGetDevAddr</a>( );</div><div class="line"></div><div class="line">    mibReq.Type = MIB_DEV_ADDR;</div><div class="line">    mibReq.Param.DevAddr = DevAddr;</div><div class="line">    <a class="code" href="_lo_ra_mac_8c.html#a7a4ee0ced221591206b09630d4a70844">LoRaMacMibSetRequestConfirm</a>( &amp;mibReq );</div><div class="line">}</div></div><!-- fragment --> <hr/>
<h2><a class="anchor" id="Hardware"></a>
Hardware Layout</h2>
<p>The hardware layout and pin definition as shown below:</p>
<div class="image">
<img src="pins1.jpg" alt="pins1.jpg"/>
</div>
 <div class="image">
<img src="pins2.jpg" alt="pins2.jpg"/>
</div>
<hr/>
<h1><a class="anchor" id="License"></a>
License</h1>
<div class="fragment"><div class="line">  ______                              _</div><div class="line"> / _____)             _              | |</div><div class="line">( (____  _____ ____ _| |_ _____  ____| |__</div><div class="line"> \____ \| ___ |    (_   _) ___ |/ ___)  _ \</div><div class="line"> _____) ) ____| | | || |_| ____( (___| | | |</div><div class="line">(______/|_____)_|_|_| \__)_____)\____)_| |_|</div><div class="line">(C)2013 Semtech</div></div><!-- fragment --><p>&mdash; Revised BSD License &mdash;<br />
Copyright (c) 2013, SEMTECH S.A.<br />
All rights reserved.<br />
</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met: Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. Neither the name of the Semtech corporation nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</p>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SEMTECH S.A. BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<hr/>
<h1><a class="anchor" id="Acknowledgements"></a>
Acknowledgements</h1>
<p>The mbed (<a href="https://mbed.org/">https://mbed.org/</a>) project was used at the beginning as source of inspiration.</p>
<p>This program uses the AES algorithm implementation (<a href="http://www.gladman.me.uk/">http://www.gladman.me.uk/</a>) by Brian Gladman.</p>
<p>This program uses the CMAC algorithm implementation (<a href="http://www.cse.chalmers.se/research/group/dcs/masters/contikisec/">http://www.cse.chalmers.se/research/group/dcs/masters/contikisec/</a>) by Lander Casado, Philippas Tsigas.</p>
<hr/>
 <h1><a class="anchor" id="sec1"></a>
Release Note</h1>
<table class="doxtable">
<tr>
<th>Date</th><th>Version</th><th>Description  </th></tr>
<tr>
<td>2017/06/05</td><td>4.3.0.3</td><td>Add GemtekGetOTAAConfig &amp; GemtekWriteOTAAKey API </td></tr>
<tr>
<td>2018/03/15</td><td>4.3.0.4</td><td>Support the data structure of AT-LoRaWAN v4.xx version. </td></tr>
<tr>
<td>2018/05/07</td><td>4.4.1.1</td><td>1.Update base on Github v4.4.1. 2.Update OTAA flow example code. </td></tr>
<tr>
<td>2018/08/17</td><td>4.4.1.2</td><td>1.Fix G78S can't uplink issue. 2.Update LoRaMacCrypto.3.Modify example project name. 4.Add more detail flow to example project for WriteGemtekConfig and JoinFlow. </td></tr>
<tr>
<td>2018/09/13</td><td>4.4.1.3</td><td>Fix mac command using wrong key issue </td></tr>
<tr>
<td>2018/09/19</td><td>4.4.1.4</td><td>1.Fix build code error when OVER_THE_AIR_ACTIVATION is not define 2.Update code for LoRaMac Class C </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
